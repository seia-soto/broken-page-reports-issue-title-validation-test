name: Validate issue title

on:
  issues:
    types: [opened, edited]
  workflow_dispatch:

jobs:
  test:
    runs-on: ubuntu-latest
    name: Validate
    steps:
      - uses: actions/checkout@v4
      - uses: jdx/mise-action@v2
      - env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          GH_REPO: ${{ github.repository }}
          NAME: ${{ github.event.inputs.name }}
          NUMBER: ${{ github.event.issue.number }}
          HAS_INVALID_TAG: ${{ contains(github.event.issue.labels.*.name, 'checks/invalid-issue-title') == true }}
        run: |
          ERR="$(deno run './src/validate-issue-title.ts' "${name}" 2>&1 >/dev/null)";
          [[ "${ERR}" != '' && "${HAS_INVALID_TAG}" != true ]]; gh issue comment "${NUMBER}" --body "‚ùå This issue title is not in a valid format: ```${ERR}```";
          [[ "${ERR}" == '' && "${HAS_INVALID_TAG}" == true ]]; gh issue edit "${NUMBER}" --remove-label 'checks/invalid-issue-title';
